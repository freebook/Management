<?xml version="1.0" encoding="UTF-8"?>
<section id="backup">
	<title>备份流程</title>
	<para>下面流程是自动化完成，这里分部讲解</para>
	<procedure>
		<title>升级操作流程</title>
		<step>
			<para>数据备份</para>
			<para>通常绝大多数人，备份还采用 cp / tar / 以及稍微有点技术含量的rsync做差异备份 例如</para>
			<screen>
					<![CDATA[
cp -r /www/example.com/www.example.com /backup/www.example.com-2016-05-23
tar zcvf www.example.com-2016-05-23.tgz /www/example.com/www.example.com

rsync -auzv /www/example.com/www.example.com /backup/www.example.com-2016-05-23
					]]>
			</screen>
			<para>这种备份适合比较小的软件包，对于图片服务器什么的就比较耗时。我很早就开始尝试使用快照备份当时使用LVM，后来转为Btrfs文件系统，到2010的时候btrfs快照已经非常成熟.
			</para>
			<screen>
					<![CDATA[
[root@www.netkiller.cn www]# btrfs subvolume snapshot /www /www/backup_2016-05-23
Create a snapshot of '/www' in '/www/backup_2016-05-23'
					]]>
			</screen>
			<para>快照瞬间建立，使用下面命令查看快照</para>
			<screen>
					<![CDATA[
[root@www.netkiller.cn www]# btrfs subvolume list /www
ID 284 gen 18583 top level 5 path backup_2016-05-23
					]]>
			</screen>
			<para>挂载快照</para>
			<screen>
					<![CDATA[
[root@www.netkiller.cn www]# mount -t btrfs -o subvol=backup_2016-05-23 /dev/xvdb1 /mnt
[root@www.netkiller.cn www]# ll /mnt/
					]]>
			</screen>
			<para>
				关于BTRFS详细使用方法，请参考
				<ulink url="http://www.netkiller.cn/linux/index.html">《Netkiller Linux 手札》</ulink>
			</para>
		</step>
		<step>
			<para></para>

			<para></para>
		</step>
		<step>
			<para></para>

		</step>
		<step>
			<para></para>
			<substeps>
				<step>
					<para></para>
				</step>
				<step>
					<para></para>
				</step>
			</substeps>
		</step>
		<step>
			<para></para>
		</step>
	</procedure>

</section>
